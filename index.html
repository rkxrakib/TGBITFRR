<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>FoxiGrow - Earn Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
    <style>
        :root { --bg: #0d0d12; --surf: #1c1c24; --acc: #ffb400; --acc-sec: #ff7622; --text: #ffffff; --dim: #a1a1aa; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { background-color: var(--bg); color: var(--text); padding-bottom: 90px; }
        #app { max-width: 480px; margin: 0 auto; padding: 20px; }
        
        /* HEADER */
        .header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 25px; }
        .user-box { display: flex; align-items: center; gap: 12px; }
        .avatar { width: 65px; height: 65px; border-radius: 50%; border: 2px solid var(--acc-sec); padding: 3px; }
        .u-info h3 { font-size: 1.1rem; font-weight: 800; }
        .lv-tag { background: #2a2a35; padding: 2px 10px; border-radius: 10px; font-size: 0.7rem; color: var(--acc); font-weight: 800; display: inline-block; margin-top: 5px; }
        
        /* STATS GRID - 3 COLUMNS */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .stat-card { background: var(--surf); padding: 15px 5px; border-radius: 20px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-card img { width: 22px; margin-bottom: 8px; }
        .stat-card h2 { font-size: 1.2rem; font-weight: 800; color: #fff; }
        .stat-card p { font-size: 0.65rem; color: var(--dim); text-transform: uppercase; margin-top: 5px; }
        .stat-card .icon-circle { width: 25px; height: 25px; background: rgba(255,118,34,0.2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 8px; color: var(--acc-sec); font-size: 0.8rem; }

        /* CHECKIN */
        .checkin-card { background: var(--surf); border-radius: 25px; padding: 20px; display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border: 1px solid var(--acc-sec); }
        .ci-btn { background: var(--acc); color: #000; border: none; padding: 10px 20px; border-radius: 12px; font-weight: 800; font-size: 0.75rem; box-shadow: 0 4px 15px rgba(255,180,0,0.3); }

        /* PAGES */
        .page { display: none; animation: fadeIn 0.4s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        /* NAV */
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: #121218; display: flex; justify-content: space-around; padding: 15px 5px; border-top: 1px solid #222; z-index: 1000; }
        .nav-item { color: var(--dim); text-align: center; font-size: 0.6rem; text-transform: uppercase; font-weight: 700; cursor: pointer; flex: 1; transition: 0.3s; }
        .nav-item i { font-size: 1.3rem; display: block; margin-bottom: 5px; }
        .nav-item.active { color: var(--acc-sec); }

        /* RANK LIST */
        .rank-item { display: flex; align-items: center; justify-content: space-between; padding: 15px; background: var(--surf); border-radius: 15px; margin-bottom: 10px; }
        .r-info { display: flex; align-items: center; gap: 12px; }
        .r-img { width: 40px; height: 40px; border-radius: 50%; }
        .r-name { font-weight: 700; font-size: 0.9rem; }
        .r-val { color: var(--acc); font-weight: 800; }
        
        /* TOAST */
        #toast { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 10px 25px; border-radius: 30px; font-weight: 700; opacity: 0; transition: 0.3s; z-index: 9999; }
        #toast.show { opacity: 1; }
    </style>
</head>
<body>

    <div id="toast">Message</div>

    <div id="app">
        <!-- HEADER -->
        <div class="header">
            <div class="user-box">
                <img id="u-img" src="https://via.placeholder.com/65" class="avatar">
                <div class="u-info">
                    <h3 id="u-name">Guest</h3>
                    <div class="lv-tag">LV.1 â€” Newbie</div>
                </div>
            </div>
            <div style="background:#2a2a35; padding:10px; border-radius:12px; color:var(--acc-sec);"><i class="fas fa-globe"></i></div>
        </div>

        <!-- STATS BOXES -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="icon-circle"><i class="fab fa-ethereum"></i></div>
                <h2 id="u-usd">0.00</h2>
                <p>USDT</p>
            </div>
            <div class="stat-card">
                <div class="icon-circle" style="color:var(--acc); background:rgba(255,180,0,0.1)"><i class="fas fa-coins"></i></div>
                <h2 id="u-coin">0</h2>
                <p>FG Coin</p>
            </div>
            <div class="stat-card">
                <div class="icon-circle" style="color:#2ecc71; background:rgba(46,204,113,0.1)"><i class="fas fa-check-double"></i></div>
                <h2 id="u-done">0</h2>
                <p>Completed</p>
            </div>
        </div>

        <div class="checkin-card">
            <div><h4 style="font-size:0.9rem;">Daily Check-in</h4><p style="color:var(--dim); font-size:0.7rem;">Check In <span style="color:var(--acc)">+1 FG Coin</span></p></div>
            <button class="ci-btn">CHECK IN</button>
        </div>

        <!-- HOME -->
        <div id="p-home" class="page active">
            <h4 style="margin-bottom:15px; font-size:0.8rem; color:var(--acc-sec);"><i class="fas fa-fire"></i> HOT TASKS</h4>
            <div id="task-area"></div>
        </div>

        <!-- RANK -->
        <div id="p-rank" class="page">
            <h4 style="margin-bottom:20px; text-align:center;">Leaderboard</h4>
            <div id="rank-list"></div>
        </div>

        <!-- ACTIVITY -->
        <div id="p-activity" class="page">
            <h4 style="margin-bottom:20px; text-align:center;">Recent Activities</h4>
            <div id="hist-area"></div>
        </div>

        <!-- PROFILE -->
        <div id="p-profile" class="page">
            <div style="background:var(--surf); padding:20px; border-radius:20px; text-align:center;">
                <h4 style="margin-bottom:15px;">Withdrawal</h4>
                <select id="w-method" style="width:100%; padding:12px; background:#0d0d12; border:none; color:#fff; border-radius:10px; margin-bottom:10px;"></select>
                <input id="w-acc" placeholder="Account Address" style="width:100%; padding:12px; background:#0d0d12; border:none; color:#fff; border-radius:10px; margin-bottom:10px;">
                <input id="w-amt" type="number" placeholder="Amount" style="width:100%; padding:12px; background:#0d0d12; border:none; color:#fff; border-radius:10px; margin-bottom:15px;">
                <button onclick="withdraw()" style="width:100%; padding:15px; background:var(--acc-sec); border:none; color:#fff; border-radius:15px; font-weight:800;">SUBMIT REQUEST</button>
            </div>
        </div>
    </div>

    <!-- BOTTOM NAV -->
    <div class="nav">
        <div class="nav-item active" onclick="nav('p-home', this)"><i class="fas fa-home"></i><span>Home</span></div>
        <div class="nav-item" onclick="nav('p-home', this)"><i class="fas fa-bullseye"></i><span>Tasks</span></div>
        <div class="nav-item" onclick="nav('p-rank', this)"><i class="fas fa-trophy"></i><span>Rank</span></div>
        <div class="nav-item" onclick="nav('p-activity', this)"><i class="fas fa-calendar-alt"></i><span>Activity</span></div>
        <div class="nav-item" onclick="nav('p-profile', this)"><i class="fas fa-user"></i><span>Profile</span></div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDvtZJhIN850tU7cETuiqRyCyjCBdlFt-Y",
            authDomain: "fynora-81313.firebaseapp.com",
            databaseURL: "https://fynora-81313-default-rtdb.firebaseio.com",
            projectId: "fynora-81313",
            storageBucket: "fynora-81313.firebasestorage.app",
            messagingSenderId: "593306264446",
            appId: "1:593306264446:web:da476d4c77ae4ede6b492f",
            measurementId: "G-BX0FWR2YMT"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const tg = window.Telegram.WebApp;
        tg.ready(); tg.expand();

        let userData = {};

        window.onload = () => {
            const user = tg.initDataUnsafe.user || { id: "0000", first_name: "Guest", photo_url: "" };
            const uRef = db.ref(`users/${user.id}`);
            
            uRef.on('value', snap => {
                if(!snap.exists()) {
                    const newUser = { id: user.id, firstName: user.first_name, balance: 0, coins: 0, completed: 0, photoUrl: user.photo_url || "" };
                    uRef.set(newUser);
                } else {
                    userData = snap.val();
                    document.getElementById('u-usd').innerText = (userData.balance || 0).toFixed(2);
                    document.getElementById('u-coin').innerText = (userData.coins || 0).toFixed(1);
                    document.getElementById('u-done').innerText = userData.completed || 0;
                    document.getElementById('u-name').innerText = userData.firstName;
                    if(userData.photoUrl) document.getElementById('u-img').src = userData.photoUrl;
                }
            });

            loadTasks();
            loadRanks();
            loadMethods();
        };

        function nav(p, e) {
            document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
            document.getElementById(p).classList.add('active');
            document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
            e.classList.add('active');
        }

        function loadTasks() {
            db.ref('config/webTasks').on('value', snap => {
                const area = document.getElementById('task-area'); area.innerHTML = '';
                snap.forEach(child => {
                    const t = child.val();
                    area.innerHTML += `
                        <div style="background:var(--surf); padding:15px; border-radius:20px; display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                            <div style="display:flex; align-items:center; gap:12px;">
                                <img src="${t.icon}" style="width:40px; height:40px; border-radius:10px;">
                                <div><h4 style="font-size:0.9rem;">${t.name}</h4><span style="color:var(--acc); font-size:0.75rem;">+${t.reward} USDT</span></div>
                            </div>
                            <button onclick="runTask('${child.key}', '${t.url}', ${t.reward})" style="background:var(--acc-sec); color:#fff; border:none; padding:8px 20px; border-radius:10px; font-weight:700;">START</button>
                        </div>`;
                });
            });
        }

        function runTask(id, url, reward) {
            tg.openLink(url);
            toast("Wait 15s...");
            setTimeout(() => {
                db.ref(`users/${userData.id}`).update({
                    balance: firebase.database.ServerValue.increment(reward),
                    coins: firebase.database.ServerValue.increment(reward * 10), // Coin logic
                    completed: firebase.database.ServerValue.increment(1)
                });
                toast("Reward Claimed!");
            }, 15000);
        }

        function loadRanks() {
            const list = document.getElementById('rank-list');
            // FAKE TOP 10 DATA
            const fakes = [
                {name: "ay***i", val: 200.13, img: "https://i.pravatar.cc/100?u=1"},
                {name: "Be***e", val: 68.56, img: "https://i.pravatar.cc/100?u=2"},
                {name: "In***1", val: 64.13, img: "https://i.pravatar.cc/100?u=3"},
                {name: "Sh***e", val: 62.50, img: "https://i.pravatar.cc/100?u=4"},
                {name: "Ma***o", val: 55.20, img: "https://i.pravatar.cc/100?u=5"},
                {name: "Ki***n", val: 49.00, img: "https://i.pravatar.cc/100?u=6"},
                {name: "Za***r", val: 42.15, img: "https://i.pravatar.cc/100?u=7"},
                {name: "Lu***s", val: 38.90, img: "https://i.pravatar.cc/100?u=8"},
                {name: "Ro***y", val: 35.40, img: "https://i.pravatar.cc/100?u=9"},
                {name: "No***h", val: 31.20, img: "https://i.pravatar.cc/100?u=10"}
            ];
            list.innerHTML = '';
            fakes.forEach((f, i) => {
                list.innerHTML += `<div class="rank-item">
                    <div class="r-info"><span style="width:20px; color:var(--dim)">${i+1}</span><img src="${f.img}" class="r-img"><span class="r-name">${f.name}</span></div>
                    <span class="r-val">${f.val} USD</span>
                </div>`;
            });
        }

        function loadMethods() {
            db.ref('config/withdrawMethods').on('value', snap => {
                const sel = document.getElementById('w-method'); sel.innerHTML = '';
                snap.forEach(c => { sel.innerHTML += `<option value="${c.val().name}">${c.val().name} (Min: ${c.val().min})</option>`; });
            });
        }

        function withdraw() {
            const amt = document.getElementById('w-amt').value;
            if(amt > userData.balance) return toast("Insufficient Balance");
            db.ref('withdrawals/pending').push({ userId: userData.id, userName: userData.firstName, amount: amt, method: document.getElementById('w-method').value, account: document.getElementById('w-acc').value, timestamp: firebase.database.ServerValue.TIMESTAMP });
            db.ref(`users/${userData.id}/balance`).set(firebase.database.ServerValue.increment(-amt));
            toast("Request Sent!");
        }

        function toast(m) { const t = document.getElementById('toast'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
    </script>
</body>
</html>
